; PlatformIO Project Configuration File
;
; This repo builds two firmwares for the TTGO LoRa32 SX1276 OLED (ESP32 + SX1276 + SSD1306 OLED):
; - sender: sends commands over LoRa (start/stop/run <minutes>)
; - receiver: receives commands, controls Webasto over W-BUS, reports status back
;
; IMPORTANT: Set the correct LoRa frequency for your region/board:
;   433E6, 868E6, or 915E6
;
[platformio]
default_envs = sender
src_dir = src

[env]
platform = espressif32
board = ttgo-lora32-v1
framework = arduino
monitor_speed = 115200
build_flags =
  -Iinclude
  -D CORE_DEBUG_LEVEL=0
  ; Change this to match your LoRa band (Hz):
  -D LORA_FREQUENCY_HZ=868E6
  ; LoRa params (safe defaults; tune as needed):
  -D LORA_SYNC_WORD=0x12
  -D LORA_BW=125E3
  -D LORA_SF=7
  -D LORA_CR=5
lib_deps =
  sandeepmistry/LoRa@^0.8.0
  olikraus/U8g2@^2.35.30
; Optional: Enable better debugging
build_type = debug
monitor_filters = esp32_exception_decoder

[env:sender]
upload_port = /dev/ttyWEBASTOSEND
monitor_port = /dev/ttyWEBASTOSEND
build_flags =
  ${env.build_flags}
  -D DEVICE_ROLE_SENDER=1
build_src_filter =
  +<sender/>
  -<receiver/>
; Debugging requires external JTAG adapter (ESP-Prog, FT2232H, J-Link, etc.)
; Uncomment and configure based on your hardware:
; debug_tool = esp-prog
; debug_init_break = tbreak setup
; debug_speed = 5000

[env:receiver]
upload_port = /dev/ttyWEBASTORECV
monitor_port = /dev/ttyWEBASTORECV
build_flags =
  ${env.build_flags}
  -D DEVICE_ROLE_RECEIVER=1
build_src_filter =
  +<receiver/>
  -<sender/>
; Debugging requires external JTAG adapter (ESP-Prog, FT2232H, J-Link, etc.)
; Uncomment and configure based on your hardware:
; debug_tool = esp-prog
; debug_init_break = tbreak setup
; debug_speed = 5000

[env:simulator]
board = esp32doit-devkit-v1
upload_port = /dev/ttyWEBASTOSIM
monitor_port = /dev/ttyWEBASTOSIM
build_flags =
  ${env.build_flags}
  -D DEVICE_ROLE_SIMULATOR=1
  ; Wire TTGO receiver <-> simulator via TTL UART:
  ; ESP32 GPIO16/17 (Serial2) <-> TTGO
  ; - simulator TX (GPIO17) -> TTGO RX (GPIO34)
  ; - TTGO TX (GPIO17) -> simulator RX (GPIO16)
  -D WBUS_TX_PIN=17
  -D WBUS_RX_PIN=16
build_src_filter =
  +<simulator/>
  -<sender/>
  -<receiver/>
; Debugging requires external JTAG adapter (ESP-Prog, FT2232H, J-Link, etc.)
; Uncomment and configure based on your hardware:
; debug_tool = esp-prog
; debug_init_break = tbreak setup
; debug_speed = 5000